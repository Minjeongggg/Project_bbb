/*
 * name : SCR-BIZ05-01-P001.js
 * desc : 상품 상세(내서) 전용 실행 자바스크립트
 * writer : glim
 * create : 2021/11/30
 * update :
 * -
 */

$(function () {
	$('.prod_thumb_item .size_compare_box').each(function () {
		setSizeCompareImgRatio(this, {
			width: parseInt($('.thumb_size', this).text().split('x')[0]),
			height: parseInt($('.thumb_size', this).text().split('x')[1]),
		});
	});
});

function setSizeCompareImgRatio(target, prodThumbSizes) {
	var boxMinWidth,
		boxMaxHeight,
		baseWidth,
		paperSizes,
		paperRatios,
		prodThumbRatios,
		defBoxSizes,
		thumbBoxSizes;

	boxMinWidth = 58;	// 박스의 최소 넓이값
	boxMaxHeight = 461;	// 박스의 최대 높이값
	baseWidth = $('.size_compare_inner', target).width() - 20;	// 전체 박스 사이즈 - 각 박스 사이 여백 20px
	paperSizes = {
		width: 210,
		height: 297
	};	// A4용지 사이즈

	// A4 용지의 비율
	paperRatios = paperSizes.width / (paperSizes.width + prodThumbSizes.width);
	// 상품 이미지의 비율
	prodThumbRatios = prodThumbSizes.width / (paperSizes.width + prodThumbSizes.width);
	defBoxSizes = {
		width: Math.floor(baseWidth * paperRatios),
		height: Math.floor(paperSizes.height * (baseWidth * paperRatios) / paperSizes.width),
	};

	thumbBoxSizes = {
		width: Math.floor(baseWidth * prodThumbRatios),
		height: Math.floor(Math.min(boxMaxHeight, prodThumbSizes.height * (baseWidth * prodThumbRatios) / prodThumbSizes.width)),
	}

	// 기준 A4 사이즈가 최소 넓이보다 작아지려고 하는 경우
	if (boxMinWidth >= defBoxSizes.width) {
		// console.log('A4 최소 사이즈');
		// A4 넓이는 최소 넓이 값으로 지정, 높이는 비율대로 조정
		defBoxSizes.width = boxMinWidth;
		defBoxSizes.height = Math.floor(paperSizes.height * boxMinWidth / paperSizes.width);
		$('.compare_def_box', target).addClass('minimize');

		// 상품 이미지 넓이는 전체 넓이에서 최소 넓이를 제외한 값으로 지정, 높이는 지정된 넓이 기준 비율대로 조정하되 최대 높이값을 넘지 않도록 함
		thumbBoxSizes.width = baseWidth - boxMinWidth;
		thumbBoxSizes.height = Math.floor(Math.min(boxMaxHeight, Math.max(thumbBoxSizes.height, thumbBoxSizes.width * (prodThumbSizes.width / prodThumbSizes.height))));
	} else if (boxMinWidth >= thumbBoxSizes.width) {
		// console.log('상품 이미지 최소 사이즈');
		// 상품 이미지 사이즈가 최소 넓이보다 작아지려고 하는 경우
		// 상품 이미지 넓이는 최소 넓이 값으로 지정, 높이는 지정된 넓이 기준 비율대로 조정하되 최소 넓이값, 최대 높이값을 넘지 않도록 함
		thumbBoxSizes.width = boxMinWidth;
		thumbBoxSizes.height = Math.floor(Math.min(boxMaxHeight, Math.max(boxMinWidth, thumbBoxSizes.height * boxMinWidth / thumbBoxSizes.width)));

		// A4 넓이는 전체 넓이에서 최소 넓이를 제외한 값으로 지정, 높이는 지정된 넓이 기준 비율대로 조정하되 최대 높이값을 넘지 않도록 함
		defBoxSizes.width = baseWidth - boxMinWidth;
		defBoxSizes.height = Math.floor(Math.min(boxMaxHeight, Math.max(defBoxSizes.height, defBoxSizes.width * (paperSizes.width / paperSizes.height))));
	}

	$('.compare_def_box', target).css(defBoxSizes);
	$('.compare_thumb_box', target).css(thumbBoxSizes);
}
/* s : 시즈널 아이콘 */
// 문서가 jQuery를 사용하여 로드된 후 실행
$(document).ready(function() {
  // 각 텍스트 요소를 반복 처리
  $('.btn_gift .text').each(function() {
    const $textElement = $(this);

    // 텍스트를 개별 글자로 분할하고 각 글자를 스팬으로 감싸기
    const textContent = $textElement.text();
    const newTextContent = Array.from(textContent).map(char => `<span>${char}</span>`).join('');
    $textElement.html(newTextContent);

    // 각 글자의 스팬 요소를 선택하고 애니메이션 적용
    $textElement.find('span').each(function(index) {
      $(this).css({
        display: 'inline-block',
        animation: `text_bounce 3.4s forwards ${index * 0.1}s`
      });
    });
  });
  setTimeout(function () {
    // btn_gift_lottie 클래스를 가진 요소 찾기
    var bubble_text = document.querySelector(".bubble_text");
    if (bubble_text) {
      if (bubble_text) {
        // bubble_text를 화면에서 감추기
        bubble_text.style.opacity = 0;
      }
    }
  }, 3400); // 3400 밀리초

  setTimeout(function () {
    // btn_gift_lottie 클래스를 가진 요소 찾기
    var GiftSeasonal = document.querySelector(".gift_lottie");
    if (GiftSeasonal) {
      if (GiftSeasonal) {
        // GiftSeasonal를 화면에서 감추기
        GiftSeasonal.style.opacity = 0;
      }
    }
  }, 3200); // 3200 밀리초

  setTimeout(function () {
    // ico_gift 클래스를 가진 요소 찾기
    var IcoGift = document.querySelector(".ico_gift");
    if (IcoGift) {
      if (IcoGift) {
        // IcoGift를 화면에 보여주기
        IcoGift.style.opacity = 1;
      }
    }
  }, 3600); // 3200 밀리초
});
/* e : 시즈널 아이콘 */
